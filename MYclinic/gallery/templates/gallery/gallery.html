{% extends 'base.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- RTL wrapper for all content -->
<div dir="rtl" class="rtl-content">

<!-- RTL specific styles -->
<style>
/* Fix RTL alignment issues */
.rtl-content {
    direction: rtl;
    text-align: right;
}

/* Fix RTL margins */
.rtl-content .me-2 {
    margin-left: 0.5rem !important;
    margin-right: 0 !important;
}

.rtl-content .ms-2 {
    margin-right: 0.5rem !important;
    margin-left: 0 !important;
}

/* Fix RTL button alignment */
.rtl-content .row .col-md-4.text-center {
    text-align: center !important;
}

/* Fix RTL carousel controls */
.rtl-content .carousel-control-prev {
    right: 0;
    left: auto;
}

.rtl-content .carousel-control-next {
    left: 0;
    right: auto;
}

/* Carousel Styles */
.carousel-main-image {
    height: 500px;
    object-fit: cover;
    cursor: pointer;
}

.carousel-indicators {
    margin-bottom: -30px;
    z-index: 10;
}

.carousel-indicators [data-bs-target] {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #198754;
    background-color: transparent;
    margin: 0 5px;
}

.carousel-indicators .active {
    background-color: #198754;
}

.carousel-control-prev,
.carousel-control-next {
    width: 5%;
    color: #198754;
}

.carousel-control-prev-icon,
.carousel-control-next-icon {
    background-color: rgba(25, 135, 84, 0.8);
    border-radius: 50%;
    padding: 20px;
    width: 50px;
    height: 50px;
}

.carousel-control-prev-icon:hover,
.carousel-control-next-icon:hover {
    background-color: rgba(25, 135, 84, 1);
    transform: scale(1.1);
}

/* Gallery Grid Styles */
.gallery-image {
    cursor: pointer;
    transition: transform 0.3s ease;
    height: 200px;
    object-fit: cover;
}

.gallery-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.gallery-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
}

.gallery-card:hover .gallery-image {
    transform: scale(1.1);
}

.overlay {
    background: rgba(25, 135, 84, 0.8);
    opacity: 0;
    transition: opacity 0.3s ease;
    cursor: pointer;
    z-index: 5;
    pointer-events: none;
}

.gallery-card:hover .overlay {
    opacity: 1;
    pointer-events: all;
}

.overlay i {
    color: white;
    font-size: 2.5rem;
    transition: transform 0.3s ease;
    pointer-events: none;
}

.overlay:hover i {
    transform: scale(1.2);
}

.overlay:active {
    background: rgba(25, 135, 84, 0.9);
}

.overlay:active i {
    transform: scale(0.9);
}

/* Filter Buttons */
.btn-outline-success.active {
    background-color: #198754;
    border-color: #198754;
    color: white;
    box-shadow: 0 4px 8px rgba(25, 135, 84, 0.3);
}

.btn-outline-success:hover {
    background-color: #198754;
    border-color: #198754;
    color: white;
    transform: translateY(-2px);
}

/* Animation */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.gallery-item {
    animation: fadeIn 0.6s ease;
}

/* Responsive */
@media (max-width: 768px) {
    .carousel-main-image {
        height: 300px;
    }
    
    .btn-group {
        flex-direction: column;
        gap: 10px;
    }
    
    .btn-group .btn {
        border-radius: 25px !important;
        margin: 5px 0;
    }
    
    .gallery-image {
        height: 180px;
    }
}

@media (max-width: 576px) {
    .carousel-caption {
        display: none !important;
    }
}

/* Auto-play indicator */
.carousel-indicators {
    margin-bottom: -30px;
    z-index: 2;
}

/* Modern card design */
.card {
    border-radius: 15px;
    overflow: hidden;
}

.card-img-top {
    border-radius: 0;
}

/* Icon improvements */
.btn i {
    font-size: 14px;
}

.calendar-icon {
    transition: transform 0.3s ease;
}

.card:hover .calendar-icon {
    transform: scale(1.1);
}
</style>

<!-- هدر گالری -->
<div class="container my-5">
  <div class="text-center mb-5">
    <h1 class="fw-bold text-success mb-3">گالری تصاویر مطب</h1>
    <p class="lead text-muted">نگاهی به فضای مدرن و مجهز مطب دکتر علی شهسواری</p>
  </div>
</div>

<!-- بخش معرفی مطب -->
<section class="bg-light py-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h2 class="fw-bold text-success mb-4">فضای مدرن و دلنشین</h2>
        <p class="lead mb-4">
          مطب دکتر شهسواری با فضایی آرام و مجهز به جدیدترین تجهیزات پزشکی، محیطی مناسب برای تشخیص و درمان بیماری‌های داخلی فراهم آورده است.
        </p>
        <div class="row">
          <div class="col-6">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-check-circle text-success me-2"></i>
              <span>تجهیزات مدرن</span>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-check-circle text-success me-2"></i>
              <span>محیط بهداشتی</span>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-check-circle text-success me-2"></i>
              <span>فضای آرام</span>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-check-circle text-success me-2"></i>
              <span>دسترسی آسان</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6 text-center">
        {% if images %}
          <img src="{{ images.0.image.url }}" 
               alt="{{ images.0.title|default:'نمای کلی مطب' }}" class="img-fluid rounded shadow">
        {% else %}
          <img src="https://via.placeholder.com/500x400.png?text=مطب+دکتر+شهسواری" 
               alt="نمای کلی مطب" class="img-fluid rounded shadow">
        {% endif %}
      </div>
    </div>
  </div>
</section>

<!-- گالری تصاویر -->
<section class="py-5">
  <div class="container">
    <h2 class="text-center fw-bold text-success mb-5">تصاویر مطب</h2>
    
    {% if images %}
      <!-- Carousel برای همه تصاویر -->
      <div id="galleryCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
        <div class="carousel-indicators">
          {% for image in images %}
            <button type="button" data-bs-target="#galleryCarousel" data-bs-slide-to="{{ forloop.counter0 }}" 
                    {% if forloop.first %}class="active"{% endif %} aria-current="true" 
                    aria-label="تصویر {{ forloop.counter }}"></button>
          {% endfor %}
        </div>
        
        <div class="carousel-inner rounded shadow">
          {% for image in images %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <img src="{{ image.image.url }}" class="d-block w-100 carousel-main-image" 
                   alt="{{ image.title|default:'تصویر مطب' }}"
                   data-bs-toggle="modal" 
                   data-bs-target="#imageModal"
                   data-image="{{ image.image.url }}"
                   data-title="{{ image.title|default:'تصویر مطب' }}">
              <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-75 rounded">
                <h5 class="text-white">{{ image.title|default:'تصویر مطب' }}</h5>
                <p class="text-white-50">{{ image.description|default:'تصویری از مطب دکتر شهسواری' }}</p>
              </div>
            </div>
          {% endfor %}
        </div>
        
        <button class="carousel-control-prev" type="button" data-bs-target="#galleryCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">قبلی</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#galleryCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">بعدی</span>
        </button>
      </div>

      <!-- دسته‌بندی تصاویر -->
      <div class="text-center mb-5">
        <h4 class="fw-bold text-success mb-4">مشاهده بر اساس دسته‌بندی</h4>
        <div class="btn-group" role="group" aria-label="فیلتر تصاویر">
          <button type="button" class="btn btn-outline-success active" data-filter="all">
            <i class="fas fa-images me-2"></i>همه تصاویر ({{ images.count }})
          </button>
          {% regroup images by category as category_list %}
          {% for category in category_list %}
            <button type="button" class="btn btn-outline-success" data-filter="{{ category.grouper }}">
              {% if category.grouper == 'waiting-room' %}
                <i class="fas fa-couch me-2"></i>سالن انتظار
              {% elif category.grouper == 'office' %}
                <i class="fas fa-user-md me-2"></i>اتاق مطالعه
              {% elif category.grouper == 'equipment' %}
                <i class="fas fa-stethoscope me-2"></i>تجهیزات
              {% elif category.grouper == 'exterior' %}
                <i class="fas fa-building me-2"></i>نمای بیرونی
              {% endif %}
              ({{ category.list|length }})
            </button>
          {% endfor %}
        </div>
      </div>

      <!-- شبکه تصاویر برای فیلتر -->
      <div class="row g-4" id="gallery-grid">
        {% for image in images %}
          <div class="col-lg-3 col-md-4 col-sm-6 gallery-item" data-category="{{ image.category }}">
            <div class="card border-0 shadow-sm h-100 gallery-card">
              <div class="position-relative overflow-hidden">
                <img src="{{ image.image.url }}" 
                     class="card-img-top gallery-image" 
                     alt="{{ image.title|default:'تصویر مطب' }}" 
                     data-bs-toggle="modal" 
                     data-bs-target="#imageModal"
                     data-image="{{ image.image.url }}"
                     data-title="{{ image.title|default:'تصویر مطب' }}">
                <div class="overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                  <i class="fas fa-search-plus text-white fs-2"></i>
                </div>
              </div>
              <div class="card-body text-center">
                <h6 class="card-title text-success fw-bold">{{ image.title|default:'تصویر مطب' }}</h6>
                <small class="text-muted">
                  {% if image.category == 'waiting-room' %}سالن انتظار
                  {% elif image.category == 'office' %}اتاق مطالعه
                  {% elif image.category == 'equipment' %}تجهیزات
                  {% elif image.category == 'exterior' %}نمای بیرونی
                  {% endif %}
                </small>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      
    {% else %}
      <div class="col-12 text-center py-5">
        <div class="mb-4">
          <i class="fas fa-images text-muted" style="font-size: 4rem;"></i>
        </div>
        <h4 class="text-muted mb-3">هنوز تصویری آپلود نشده است</h4>
        <p class="text-muted">برای نمایش گالری، ابتدا تصاویر را آپلود کنید.</p>
        <a href="/admin/gallery/image/add/" class="btn btn-success" target="_blank">
          <i class="fas fa-plus me-2"></i>افزودن تصویر جدید
        </a>
      </div>
    {% endif %}
  </div>
</section>

<!-- بخش ویژگی‌های مطب -->
<section class="bg-light py-5">
  <div class="container">
    <h2 class="text-center fw-bold text-success mb-5">ویژگی‌های مطب دکتر شهسواری</h2>
    <div class="row g-4">
      
      <div class="col-md-6 col-lg-3">
        <div class="card border-success shadow-sm h-100 text-center">
          <div class="card-body">
            <div class="calendar-icon bg-success bg-opacity-75 text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; font-size: 24px;">
              <i class="fas fa-stethoscope"></i>
            </div>
            <h5 class="card-title text-success fw-bold">تجهیزات مدرن</h5>
            <p class="card-text text-muted">جدیدترین تجهیزات تشخیصی و درمانی</p>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-success shadow-sm h-100 text-center">
          <div class="card-body">
            <div class="calendar-icon bg-success bg-opacity-75 text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; font-size: 24px;">
              <i class="fas fa-shield-alt"></i>
            </div>
            <h5 class="card-title text-success fw-bold">بهداشت کامل</h5>
            <p class="card-text text-muted">رعایت کامل اصول بهداشتی و استریل</p>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-success shadow-sm h-100 text-center">
          <div class="card-body">
            <div class="calendar-icon bg-success bg-opacity-75 text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; font-size: 24px;">
              <i class="fas fa-clock"></i>
            </div>
            <h5 class="card-title text-success fw-bold">وقت‌شناسی</h5>
            <p class="card-text text-muted">احترام به وقت بیماران و نوبت‌دهی دقیق</p>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-success shadow-sm h-100 text-center">
          <div class="card-body">
            <div class="calendar-icon bg-success bg-opacity-75 text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; font-size: 24px;">
              <i class="fas fa-user-md"></i>
            </div>
            <h5 class="card-title text-success fw-bold">تجربه بالا</h5>
            <p class="card-text text-muted">بیش از ۲۰ سال تجربه در طبابت</p>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- بخش رزرو نوبت -->
<section class="py-5 bg-white">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h3 class="fw-bold text-success mb-3">آماده ویزیت هستید؟</h3>
        <p class="lead text-muted mb-0">
          برای رزرو نوبت و دریافت مشاوره تخصصی با ما تماس بگیرید یا از سیستم آنلاین استفاده کنید.
        </p>
      </div>
      <div class="col-md-4 text-center">
        <a href="{% url 'appointments:book_appointment' %}" class="btn btn-success btn-lg rounded-pill px-4">
          <i class="fas fa-calendar-plus me-2"></i>
          رزرو نوبت آنلاین
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Modal برای نمایش تصاویر بزرگ -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title text-success" id="imageModalLabel">عنوان تصویر</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center p-0">
        <img src="" alt="" class="img-fluid" id="modalImage">
      </div>
    </div>
  </div>
</div>

<!-- JavaScript برای فیلتر کردن و Modal -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap carousel
    const carouselElement = document.getElementById('galleryCarousel');
    if (carouselElement) {
        const carousel = new bootstrap.Carousel(carouselElement, {
            interval: 3000,
            wrap: true,
            keyboard: true
        });
        
        // توقف carousel هنگام hover
        carouselElement.addEventListener('mouseenter', function() {
            carousel.pause();
        });
        
        carouselElement.addEventListener('mouseleave', function() {
            carousel.cycle();
        });
    }
    
    // فیلتر کردن تصاویر
    const filterButtons = document.querySelectorAll('[data-filter]');
    const galleryItems = document.querySelectorAll('.gallery-item');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // حذف کلاس active از همه دکمه‌ها
            filterButtons.forEach(btn => btn.classList.remove('active'));
            // اضافه کردن کلاس active به دکمه کلیک شده
            this.classList.add('active');
            
            const filter = this.getAttribute('data-filter');
            
            galleryItems.forEach(item => {
                if (filter === 'all' || item.getAttribute('data-category') === filter) {
                    item.style.display = 'block';
                    item.style.animation = 'fadeIn 0.5s ease';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
    
    // Modal تصاویر برای carousel و grid
    const galleryImages = document.querySelectorAll('.gallery-image, .carousel-main-image');
    const overlayElements = document.querySelectorAll('.overlay');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('imageModalLabel');
    
    // Function to open modal
    function openModal(imageUrl, imageTitle) {
        if (modalImage && modalTitle) {
            modalImage.src = imageUrl;
            modalImage.alt = imageTitle;
            modalTitle.textContent = imageTitle;
            
            const imageModal = document.getElementById('imageModal');
            if (imageModal) {
                const modal = new bootstrap.Modal(imageModal);
                modal.show();
            }
        }
    }
    
    // Click event for gallery images
    galleryImages.forEach(image => {
        image.addEventListener('click', function() {
            const imageUrl = this.getAttribute('data-image') || this.src;
            const imageTitle = this.getAttribute('data-title') || this.alt;
            openModal(imageUrl, imageTitle);
        });
    });
    
    // Click event for overlay elements
    overlayElements.forEach(overlay => {
        overlay.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const parentCard = this.closest('.gallery-card');
            const image = parentCard.querySelector('.gallery-image');
            
            if (image) {
                const imageUrl = image.getAttribute('data-image') || image.src;
                const imageTitle = image.getAttribute('data-title') || image.alt;
                openModal(imageUrl, imageTitle);
            }
        });
    });
});
</script>

<!-- End RTL wrapper -->
{% endblock %}